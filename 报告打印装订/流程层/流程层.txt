*** Settings ***
Library           Selenium2Library
Library           re
Resource          ../组件层/报告装订打印.txt
Resource          ../../公共模块.txt
Resource          ../元素层/元素层.txt
Resource          ../../变更审批/元素层/元素层.txt

*** Keywords ***
正确数据查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${流水号}=None    ${报告号}=None    ${项目地址}=None
    ...    ${小区名称}=None
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量
    log    ${查询类型}
    log    ${路径}
    ${输入参数}    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}
    ...    ${路径}
    Comment    输入流水号    ${流水号}
    变更点击查询按钮
    等待列表创建完毕
    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    ${获取报告打印第一页列数}    获取报告装订打印查询数据列数
    Run Keyword If    ${获取报告打印第一页行数}>10    ${获取报告打印第一页行数}    Set Variable    ${获取报告打印第一页行数}-1
    查询结果检测    ${获取报告打印第一页行数}    ${获取报告打印第一页列数}    ${输入参数}    ${查询类型}    ${路径}    ${列表路径}
    [Return]    ${总数据量}

错误特殊字符查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${流水号}    ${报告号}    ${项目地址}
    ...    ${小区名称}
    清空输入框装订流水号    ${路径}
    等待列表创建完毕
    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}    ${路径}
    Comment    输入流水号    ${流水号}
    Comment    ${提示语}    get text    xpath=html/body/div[2]/div[1]
    ${提示语}    get text    //div[@class='tooltip tooltip-right']
    特殊字符校验提示语    ${查询类型}    ${提示语}
    Comment    should be equal    ${提示语}    请输入正的确流水号
    Comment    变更点击查询按钮
    Comment    等待列表创建完毕

为空查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${总数据量}    ${流水号}    ${报告号}
    ...    ${项目地址}    ${小区名称}
    清空输入框装订流水号    ${路径}
    等待列表创建完毕
    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}    ${路径}
    Comment    输入流水号    ${流水号}
    变更点击查询按钮
    等待列表创建完毕
    ${新总数}    获取页面显示总数据量
    Should Be Equal    ${新总数}    ${总数据量}

模糊查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${流水号}    ${报告号}    ${项目地址}
    ...    ${小区名称}
    清空输入框装订流水号    ${路径}
    等待列表创建完毕
    ${输入参数}    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}
    ...    ${路径}
    Comment    输入流水号    ${流水号}
    变更点击查询按钮
    等待列表创建完毕
    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    ${获取报告打印第一页列数}    获取报告装订打印查询数据列数
    查询结果检测    ${获取报告打印第一页行数}    ${获取报告打印第一页列数}    ${输入参数}    ${查询类型}    ${路径}    ${列表路径}

错误查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${总数据量}    ${流水号}    ${报告号}
    ...    ${项目地址}    ${小区名称}
    清空输入框装订流水号    ${路径}
    等待列表创建完毕
    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}    ${路径}
    Comment    输入流水号    ${流水号}
    变更点击查询按钮
    等待列表创建完毕
    ${新总数}    获取页面显示总数据量
    Should Be Equal    ${新总数}    0

超长字符查询
    [Arguments]    ${查询类型}    ${路径}    ${列表路径}    ${总数据量}    ${流水号}    ${报告号}
    ...    ${项目地址}    ${小区名称}
    清空输入框装订流水号    ${路径}
    等待列表创建完毕
    根据查询条件选择查询类型    ${查询类型}    ${流水号}    ${报告号}    ${项目地址}    ${小区名称}    ${路径}
    Comment    输入流水号    ${流水号}
    ${获取输入参数最终值}    获取输入参数最终值    ${查询类型}    ${路径}
    ${n}    Get List Count    ${获取输入参数最终值}
    超长字符校验    ${查询类型}    ${n}
    清空输入框装订流水号    ${路径}
    Comment    超长流水号字符校验    ${n}
    Comment    Close Browser

装订状态查询
    [Arguments]    ${装订状态列表值}    ${路径}    ${col}    ${状态}=0
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    Comment    ${总数据量}    报告装订打印打开模块公共方法
    根据装订状态选择查询方式    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    装订状态    ${装订状态列表值}    ${路径}    ${状态}
    变更点击查询按钮    ${状态}
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    ${获取报告打印第一页行数}    Run Keyword If    ${状态}==0    获取报告装订打印查询数据行数
    ...    ELSE    重新获取报告装订打印查询数据行数    ${路径}
    Comment    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    ${获取报告打印第一页列数}    获取报告装订打印查询数据列数
    Run Keyword If    ${获取报告打印第一页行数}==0    log    查询数据为空，请确保数据库是否有数据
    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    Comment    Run Keyword If    ${获取报告打印第一页行数}>10    重新获取报告装订打印查询数据行数    ${装订状态列表值}    ${路径}    ${col}
    ...    ELSE    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    Comment    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    高级查询下拉框    装订打印    ${装订状态列表值}    ${路径}
    [Return]    ${总数据量}

报告装订打印完成
    [Arguments]    ${流水号}    ${路径}    ${路径1}
    Comment    登录
    Comment    等待列表创建完毕
    Comment    ${总数据量}    报告装订打印打开模块公共方法
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量
    装订状态    装订未完成    ${路径1}
    变更点击查询按钮
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量
    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    检测是否存在装订未完成数据    ${获取报告打印第一页行数}    ${流水号}    ${路径}

高级下拉框查询
    [Arguments]    ${装订状态列表值}    ${路径}    ${col}    ${状态}=0    ${按钮状态}=0
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    Comment    ${总数据量}    报告装订打印打开模块公共方法
    Comment    根据装订状态选择查询方式    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    Comment    装订状态    ${装订状态列表值}    ${路径}    ${状态}
    Run Keyword If    ${按钮状态}==0    高级查询按钮
    sleep    3
    编辑可输入下拉框    ${路径}    ${装订状态列表值}    1
    变更点击查询按钮    ${状态}
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    ${获取报告打印第一页行数}    Run Keyword If    ${状态}==0    获取报告装订打印查询数据行数
    ...    ELSE    重新获取报告装订打印查询数据行数    ${路径}
    Comment    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    ${获取报告打印第一页列数}    获取报告装订打印查询数据列数
    Run Keyword If    ${获取报告打印第一页行数}==0    log    查询数据为空，请确保数据库是否有数据
    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    Comment    Run Keyword If    ${获取报告打印第一页行数}>10    重新获取报告装订打印查询数据行数    ${装订状态列表值}    ${路径}    ${col}
    ...    ELSE    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    Comment    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    [Return]    ${总数据量}

高级可输入框查询
    [Arguments]    ${装订状态列表值}    ${路径}    ${col}    ${状态}=0    ${按钮状态}=0
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    Comment    ${总数据量}    报告装订打印打开模块公共方法
    Comment    根据装订状态选择查询方式    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    Comment    装订状态    ${装订状态列表值}    ${路径}    ${状态}
    Run Keyword If    ${按钮状态}==0    高级查询按钮
    sleep    3
    Comment    编辑可输入下拉框    ${路径}    ${装订状态列表值}    1
    Input Text    xpath=.//div[contains(@class,"panel") and contains(@style,"display: block")]//*[@id='${路径}']    ${装订状态列表值}
    变更点击查询按钮    ${状态}
    等待列表创建完毕
    ${总数据量}    获取页面显示总数据量    ${状态}
    ${获取报告打印第一页行数}    Run Keyword If    ${状态}==0    获取报告装订打印查询数据行数
    ...    ELSE    重新获取报告装订打印查询数据行数    ${路径}
    Comment    ${获取报告打印第一页行数}    获取报告装订打印查询数据行数
    ${获取报告打印第一页列数}    获取报告装订打印查询数据列数
    Run Keyword If    ${获取报告打印第一页行数}==0    log    查询数据为空，请确保数据库是否有数据
    Comment    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}    ${状态}
    Comment    Run Keyword If    ${获取报告打印第一页行数}>10    重新获取报告装订打印查询数据行数    ${装订状态列表值}    ${路径}    ${col}
    ...    ELSE    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    Comment    查询操作单元结果检测    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}    ${col}
    获取table每一列数据    ${获取报告打印第一页行数}    ${装订状态列表值}    ${路径}
    [Return]    ${总数据量}
